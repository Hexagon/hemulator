# Test ROMs

This directory contains minimal test ROMs for smoke testing each emulated system.

**For detailed test ROM requirements and guidelines**, see [AGENTS.md](../AGENTS.md#test-rom-requirements).

## Purpose

These test ROMs are designed to:
1. Verify basic system functionality (CPU, memory, video output)
2. Provide deterministic output for automated testing
3. Serve as reference implementations for new systems

## Current Systems

- **NES** - Full implementation with smoke test
- **SNES** - Minimal implementation with smoke test
- **Game Boy** - Implementation with smoke test and visible output validation
- **Game Boy Color** - DMG-compatible mode with smoke test
- **Atari 2600** - Full implementation with smoke test
- **N64** - Basic RDP display list implementation with smoke test

## Future Systems

When implementing new systems, follow this pattern:
1. Create a subdirectory: `test_roms/<system>/`
2. Write minimal assembly code that produces visible output
3. Add build script and built ROM
4. Add smoke test to system crate
5. Update this README and [AGENTS.md](../AGENTS.md#test-rom-requirements)

## Building

Each system has a `build.sh` script that assembles the test ROM from source:

```bash
# NES
cd nes && ./build.sh

# SNES
cd snes && ./build.sh

# Game Boy
cd gb && ./build.sh

# Atari 2600
cd atari2600 && ./build.sh

# N64
cd n64 && ./build.sh
```

## Requirements

- **NES**: cc65 (6502 assembler/linker)
- **SNES**: cc65 (65816 assembler/linker, compatible with 6502 tools)
- **Game Boy**: rgbds (GB assembler/linker)
- **Atari 2600**: dasm (6502 assembler)
- **N64**: Python 3 (for ROM generation script)

On Ubuntu/Debian:
```bash
sudo apt-get install cc65 dasm python3

# For rgbds, build from source:
git clone https://github.com/gbdev/rgbds.git
cd rgbds && make && sudo make install
```

## Test ROM Specifications

### NES (test.nes)
- Format: iNES (16-byte header)
- Mapper: 0 (NROM)
- PRG-ROM: 2 x 16KB
- CHR-ROM: 1 x 8KB
- Behavior: Displays checkerboard pattern with alternating white/red tiles
- Expected output: Visible checkerboard pattern on screen

### SNES (test.sfc)
- Format: LoROM (32KB)
- Internal header: At $FFB0-$FFDF
- Vectors: At $FFE0-$FFFF
- Behavior: Initializes PPU, writes tilemap and CHR data, displays pattern
- Expected output: Basic rendering test (infrastructure verification)

### Game Boy (test.gb)
- Format: GB ROM (with Nintendo logo)
- Size: 32KB
- Cartridge type: ROM only (no MBC)
- Behavior: Fills screen with tile $00 (checkerboard pattern)
- Expected output: Visible checkerboard pattern on screen

### Game Boy Color (test.gbc)
- Format: GBC ROM (CGB flag = 0x80, DMG compatible)
- Size: 32KB
- Cartridge type: ROM only (no MBC)
- Behavior: Same as GB test ROM, runs in DMG mode
- Expected output: Visible checkerboard pattern on screen

### Atari 2600 (test.bin)
- Format: Raw binary
- Size: 4KB
- Behavior: Sets playfield to alternating pattern ($AA)
- Expected output: Visible playfield pattern on screen

### Atari 2600 (checkerboard.bin)
- Format: Raw binary
- Size: 4KB
- Behavior: Creates checkerboard pattern by alternating playfield every 2 scanlines
- Expected output: Checkerboard pattern with ~50% white pixels

### Atari 2600 (test_timer.bin)
- Format: Raw binary
- Size: 4KB
- Behavior: Tests RIOT timer interrupt flag clear-on-read behavior
- Expected output: Playfield with changing colors based on timer

### Atari 2600 (game_test.bin)
- Format: Raw binary
- Size: 4KB
- Behavior: Game-like test ROM with realistic patterns:
  - Color bars (8 bars of 8 scanlines each, cycling through hues)
  - Sprite positioning and horizontal movement (two player sprites)
  - Multiple playfield patterns (alternating 0xAA/0x55 and 0x55/0xFF/0x00)
  - Per-scanline background color changes
- Expected output: Multi-section display with color bars, moving sprites, and playfield patterns
- Purpose: Stress-test emulator with realistic game-like behavior to expose timing and rendering issues

### N64 (test.z64)
- Format: Z64 (big-endian N64 ROM)
- Size: 1MB (minimum ROM size)
- ROM Header: Magic 0x80371240, Entry 0x80000400
- Behavior: Writes RDP display list commands to RDRAM and triggers rendering
  - Red rectangle at (50,50) to (150,150)
  - Green rectangle at (160,90) to (210,140)
- Display List Commands: SET_FILL_COLOR (0x37), FILL_RECTANGLE (0x36), SYNC_FULL (0x29)
- Expected output: Two colored rectangles visible on screen
- Note: ROM generated by Python script (no external assembler required)

## Integration with Tests

These ROMs are included in the smoke tests for each system crate:
- `crates/systems/nes/src/lib.rs` - NES smoke test
- `crates/systems/snes/src/lib.rs` - SNES smoke test
- `crates/systems/gb/src/lib.rs` - Game Boy and Game Boy Color smoke tests
- `crates/systems/atari2600/src/lib.rs` - Atari 2600 smoke test
- `crates/systems/n64/src/lib.rs` - N64 display list smoke test

The tests load each ROM (or manually construct equivalent state for N64), run it for a few frames (or process display lists), and verify that the output frame contains expected non-zero pixel data (for systems with working rendering) or correct dimensions (for minimal implementations), confirming that the emulator infrastructure is functioning correctly.
